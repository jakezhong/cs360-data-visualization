<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Mono%7CArvo:400%7CRoboto:300,400,500,700%7CCookie" rel="stylesheet">
		<link rel="stylesheet" href="../../ui/vendor/css/fontawesome.min.css">
		<link rel="stylesheet" href="../../ui/vendor/perfect-scrollbar.css">
		<link rel="stylesheet" href="../../ui/css/style.css">
		<script src="../../ui/vendor/d3.v5.min.js"></script>
		<script type="text/javascript" src="https://d3js.org/topojson.v3.min.js"></script>
		<title>CS360/560 Data Visualization</title>
	<style>
		#svg-container {
			position: relative;
			overflow: hidden;
		}

        .states {
            fill: #aaa;
        }

        .states .active {
            display:none;
        }

        .state-borders {
            fill: none;
            stroke: #000;
            stroke-width: 0.5px;
            stroke-linejoin: round;
            stroke-linecap: round;
            pointer-events: none;
        }
		
		.counties {
            fill: #aaa;
		}

		.county-borders {
			fill: none;
			stroke: #fff;
			stroke-width: 0.2px;
			stroke-linejoin: round;
			stroke-linecap: round;
			pointer-events: none;
		}
		
	</style>
	</head>
	<body>
		<div class="full-page">
			<div class="sidebar-container">
				<aside  class="sidebar sidebar-left sidebar-fixed sidebar-dark">
					<div class="scroll">
						<div class="sidebar-header text-white bg-info">
							<div class="sidebar-brand d-flex justify-content-between align-items-center">
								<div class="title text-truncate">
									Data Visulization
								</div>
								<div class="logo align-items-center justify-content-around">
									<i class="material-icons">all_inclusive</i>
								</div>
							</div>
						</div>
						<div class="sidebar-nav-container">
							<ul class="list-nav sidebar-nav list-nav-dark list-nav-dark-info">
								<li class="list-nav-group-title">
									<span>
									  FINAL PROJECT
									</span>
								</li>
								<li class="list-nav-item">
									<a href="../../" class="list-nav-link">
									  <span class="list-nav-icon">
										<i class="material-icons">home</i>
									  </span>
									  <span class="list-nav-label">Home</span>
									</a>
								</li>
								<li class="list-nav-item">
									<a href="#" class="list-nav-link">
									  	<span class="list-nav-icon">
											<i class="material-icons">folder_open</i>
									  	</span>
									  	<span class="list-nav-label">Homework 1</span>
									  	<span class="list-nav-expand">
											<i class="material-icons">add</i>
									  	</span>
									</a>
									<ul class="list-nav-child">
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework1/overview.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Overview</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework1/prototypes.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Tableau Prototypes</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework1/d3-bar.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">D3 Implementations</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework1/requirements.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Requirements</span>
										  </a>
										</li>
									</ul>
								</li>
								<li class="list-nav-item">
									<a href="#" class="list-nav-link">
									  	<span class="list-nav-icon">
											<i class="material-icons">folder_open</i>
									  	</span>
									  	<span class="list-nav-label">Homework 2</span>
									  	<span class="list-nav-expand">
											<i class="material-icons">add</i>
									  	</span>
									</a>
									<ul class="list-nav-child">
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework2/overview.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Overview</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework2/scatterplot-matrix.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Scatterplot Matrix</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework2/requirements.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Requirements</span>
										  </a>
										</li>
									</ul>
								</li>
								<li class="list-nav-item">
									<a href="#" class="list-nav-link">
									  	<span class="list-nav-icon">
											<i class="material-icons">folder_open</i>
									  	</span>
									  	<span class="list-nav-label">Homework 3</span>
									  	<span class="list-nav-expand">
											<i class="material-icons">add</i>
									  	</span>
									</a>
									<ul class="list-nav-child">
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework3/overview.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Overview</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework3/implementation.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Implementations</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework3/requirements.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Requirements</span>
										  </a>
										</li>
									</ul>
								</li>
								<li class="list-nav-item">
									<a href="#" class="list-nav-link">
									  	<span class="list-nav-icon">
											<i class="material-icons">folder_open</i>
									  	</span>
									  	<span class="list-nav-label">Homework 4</span>
									  	<span class="list-nav-expand">
											<i class="material-icons">add</i>
									  	</span>
									</a>
									<ul class="list-nav-child">
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework4/overview.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Overview</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework4/implementation.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Implementations</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../homework4/requirements.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Requirements</span>
										  </a>
										</li>
									</ul>
								</li>
								<li class="list-nav-item">
									<a href="#" class="list-nav-link">
									  	<span class="list-nav-icon">
											<i class="material-icons">folder_open</i>
									  	</span>
									  	<span class="list-nav-label">Midterm</span>
									  	<span class="list-nav-expand">
											<i class="material-icons">add</i>
									  	</span>
									</a>
									<ul class="list-nav-child">
										<li class="list-nav-item list-nav-child-item">
										  <a href="../midterm/prototype.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Prototype</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="../midterm/implementation.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Implementation</span>
										  </a>
										</li>
									</ul>
								</li>
								<li class="list-nav-item">
									<a href="#" class="list-nav-link">
									  	<span class="list-nav-icon">
											<i class="material-icons">folder_open</i>
									  	</span>
									  	<span class="list-nav-label">Final</span>
									  	<span class="list-nav-expand">
											<i class="material-icons">add</i>
									  	</span>
									</a>
									<ul class="list-nav-child">
										<li class="list-nav-item list-nav-child-item">
										  <a href="overview.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Overview</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="about.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">About</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="dataset.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Dataset</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="alpha.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Alpha Release</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="beta.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Beta Release</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="final.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Final Release</span>
										  </a>
										</li>
										<li class="list-nav-item list-nav-child-item">
										  <a href="requirements.html" class="list-nav-link">
											<span class="list-nav-icon list-nav-icon-sm">
											  <i class="material-icons">keyboard_arrow_right</i>
											</span>
											<span class="list-nav-label">Requirements</span>
										  </a>
										</li>
									</ul>
								</li>
							</ul>
						</div>
					</div>
				</aside>
			</div>
			<div class="page">
				<div class="topbar-container">
					<nav class="navbar bg-white text-secondary navbar-expand-sm py-0 topbar fixed">
						<button class="btn btn-flat-secondary btn-sm btn-icon mr-1 no-shadow d-none d-xl-block sidebar-toggle">
							<i class="material-icons">menu</i>
						</button>
						<button class="btn btn-flat-secondary btn-sm btn-icon mr-1 d-xl-none no-shadow sidebar-hide">
							<i class="material-icons">menu</i>
						</button>

						<div class="navbar-text ml-3 d-none d-sm-block">
							<h5 class="m-0 text-dark">Final Project</h5>
						</div>

						<div class="ml-auto d-sm-flex ml-3">
							<ul class="navbar-nav">
								<li class="nav-item no-caret">
									<a href="../about.html" class="nav-link text-center">About</a>
								</li>
								<li class="nav-item no-caret">
									<a href="../resources.html" class="nav-link text-center">Resources</a>
								</li>
								<li class="nav-item no-caret">
									<a href="https://jakezhong.com" target="_blank" class="nav-link text-center">
										<i class="far fa-globe"></i>
									</a>
								</li>
								<li class="nav-item no-caret">
									<a href="https://github.com/jakezhong" target="_blank" class="nav-link text-center">
										<i class="fab fa-github"></i>
									</a>
								</li>
								<li class="nav-item no-caret">
									<a href="https://www.linkedin.com/in/jake-zhong/" target="_blank" class="nav-link text-center">
										<i class="fab fa-linkedin-in"></i>
									</a>
								</li>
								<li class="nav-item no-caret">
									<a href="https://www.instagram.com/jakezhong_" target="_blank" class="nav-link text-center">
										<i class="fab fa-instagram"></i>
									</a>
								</li>
								<li class="nav-item no-caret">
									<a href="https://www.facebook.com/jksakura" target="_blank" class="nav-link text-center">
										<i class="fab fa-facebook"></i>
									</a>
								</li>
							</ul>
						</div>
					</nav>
				</div>
				<div class="page-content">
					<section class="section">
						<div class="container">
							<!-- Begin page content -->
							<hr class="space"/>
							<h3 class="section-title">D3 Implementations</h3>
							<div class="card work-images">
								<div class="card-body card-body-p">
									<div class="chart-container">
										<div class="implementation-container">
											<h4 class="section-title top-space">D3 Hierarchical Pack of Fire department Call Records in Feb 2020 by Neighborhoods and Call Types.</h4>
											<div id="svg-container">
												<svg id="map">
													<g id="basemap">
														<g id="states"></g>
														<g id="counties"></g>
														<g id="cities"></g>
													</g>
													<g id="legend" pointer-events="none"></g>
<!--												<g id="tooltip-pack" pointer-events="none"></g>-->
												</svg>
												<svg id="panel">
													<g id="bar-price"></g>
													<g id="bar-count"></g>
													<g id="line-price"></g>
													<g id="line-count"></g>
												</svg>
												<svg id="details">
													<g id="detail-1"></g>
													<g id="detail-2"></g>
												</svg>
											</div>
										</div>
									</div>
								</div>
							</div>
					  		<!-- End page content -->
						</div>
					</section>
				</div>
			</div>
		</div>
		<script>
			let bayareaCitiesList = ["Albany", "American Canyon", "Antioch", "Atherton", "Belmont", "Belvedere", "Benicia", "Berkeley", "Brentwood", "Brisbane", "Burlingame", "Calistoga", "Campbell", "Clayton", "Cloverdale", "Colma", "Concord", "Corte Madera", "Cotati", "Cupertino", "Daly City", "Danville", "Dixon", "Dublin", "East Palo Alto", "El Cerrito", "Emeryville", "Fairfax", "Foster City", "Fremont", "Gilroy", "Half Moon Bay", "Hayward", "Healdsburg", "Hercules", "Hillsborough", "Lafayette", "Larkspur", "Livermore", "Los Altos", "Los Altos Hills", "Los Gatos", "Martinez", "Menlo Park", "Mill Valley", "Millbrae", "Milpitas", "Monte Sereno", "Moraga", "Morgan Hill", "Mountain View", "Napa", "Newark", "Novato", "Oakland", "Oakley", "Orinda", "Pacifica", "Palo Alto", "Petaluma", "Piedmont", "Pinole", "Pittsburg", "Pleasant Hill", "Pleasanton", "Portola Valley", "Redwood City", "Richmond", "Rio Vista", "Rohnert Park", "Ross", "St. Helena", "San Anselmo", "San Carlos", "San Francisco", "San Jose", "San Leandro", "San Mateo", "San Pablo", "San Rafael", "San Ramon", "Santa Clara", "Santa Rosa", "Saratoga", "Sausalito", "Sebastopol", "Sonoma", "Suisun City", "Sunnyvale", "Tiburon", "Union City", "Vacaville", "Vallejo", "Walnut Creek", "Windsor", "Woodside", "Yountville"];
			
			let records = {};
			
			let count = {
				"2015": 0,
				"2016": 0,
				"2017": 0,
				"2018": 0,
				"2019": 0,
				"2020": 0,
				"total": 0,
				"yearMaximun": 0,
				"yearMinimun": Number.MAX_VALUE,
				"yearMaximunCity": "",
				"yearMaximunYear": "",
				"yearMinimunCity": "",
				"yearMinimunYear": "",
				"average": 0,
				"totalMaximun": 0,
				"totalMinimun": Number.MAX_VALUE
			}
			
			let price = {
				"2015": 0,
				"2016": 0,
				"2017": 0,
				"2018": 0,
				"2019": 0,
				"2020": 0,
				"total": 0,
				"yearMaximun": 0,
				"yearMinimun": Number.MAX_VALUE,
				"average": 0,
				"yearMaximunCity": "",
				"yearMaximunYear": "",
				"yearMinimunCity": "",
				"yearMinimunYear": "",
				"totalMaximun": 0,
				"totalMinimun": Number.MAX_VALUE
			}
			
			let date = [2015, 2016, 2017, 2018, 2019, 2020];
			
			let data = [];
			
			bayareaCitiesList.forEach(function(elem) {
				let record = {
					"name": "",
					"latitude": "",
					"longitude": "",
					"2015-count": 0,
					"2016-count": 0,
					"2017-count": 0,
					"2018-count": 0,
					"2019-count": 0,
					"2020-count": 0,
					"2015-2020-count": 0,
					"2015-price": 0,
					"2016-price": 0,
					"2017-price": 0,
					"2018-price": 0,
					"2019-price": 0,
					"2020-price": 0,
					"2015-2020-price": 0
				};
				record["name"] = elem;
				records[elem] = record;
			});

//			Format Example: 
//			
//			records{"city": record, "city": record, "city": record, "city": record...];
//			
//			record = {
//				"name": "Albany",
//				"2015-price": 200000,
//				"2016-price": 300000,
//				"2017-price": 400000,
//				"2018-price": 500000,
//				"2019-price": 600000,
//				"2020-price": 700000,
//				"2015-2020-price": 2700000,
//				"2015-count": 100,
//				"2016-count": 200,
//				"2017-count": 300,
//				"2018-count": 400,
//				"2019-count": 500,
//				"2020-count": 600,
//				"2015-2020-count": 2100,
//			}
//
//			prices = {
//				"2015": 1000000,
//				"2016": 1500000,
//				"2017": 2000000,
//				"2018": 2500000,
//				"2019": 3000000,
//				"2020": 3200000
//			}
//			
//			data = [record, record, record...];
			
			const details = d3
				.select("svg#details")
			  	.attr("x", 0);
			
			const g = {
				detail1: details.select("g#detail-1"),
				details: details.select("g#detail-2")
			};
			
			let colorMain = "rgb(0, 137, 255)";
			
			loadSaleCount();
			
			function loadSaleCount() {
				d3.csv("data/Sale_Counts_Seas_Adj_City.csv").then(function(data) {
					if (data == undefined) {
						console.log("Failed to load file");
						
						return;
					}
					
					data.forEach(function(d) {
						let sum = 0;

						if (records[d.RegionName] != undefined) {
							for (let i = 2015; i < 2021; i++) {
								if (i === 2020) {
									records[d.RegionName][i+"-count"] = parseInt((~~parseInt(d[i+"-01"]) + ~~parseInt(d[i+"-02"]) + ~~parseInt(d[i+"-03"])) / 3);

									break;
								}
								records[d.RegionName][i+"-count"] = parseInt((~~parseInt(d[i+"-01"]) + ~~parseInt(d[i+"-02"]) + ~~parseInt(d[i+"-03"]) + ~~parseInt(d[i+"-04"]) + ~~parseInt(d[i+"-05"]) + ~~parseInt(d[i+"-06"]) + ~~parseInt(d[i+"-07"]) + ~~parseInt(d[i+"-08"]) + ~~parseInt(d[i+"-09"]) + ~~parseInt(d[i+"-10"]) + ~~parseInt(d[i+"-11"]) + ~~parseInt(d[i+"-12"])) / 12);
							}


							for (let i = 2015; i < 2021; i++) {
								sum += records[d.RegionName][i+"-count"];
								
								count[i] += records[d.RegionName][i+"-count"];
								
								if (count.maximun < records[d.RegionName][i+"-count"]) {
									count.maximun = records[d.RegionName][i+"-count"];
									count.maximunCity = records[d.RegionName];
									count.maximunYear = i;
								} else if(count.minimun > records[d.RegionName][i+"-count"]) {
									count.minimun = records[d.RegionName][i+"-count"];
									count.minimunCity = records[d.RegionName];
									count.minimunYear = i;
								}
							}

							records[d.RegionName]["2015-2020-count"] = sum;
							
							if (count.totalMaximun < sum) {
								count.totalMaximun = sum;
							} else if(count.totalMinimun > sum) {
								count.totalMinimun = sum;
							}
							
							count.total += sum;
						}
					});
					
					count.average = ~~parseInt(count.total) / bayareaCitiesList.length;
				});
				loadAllHomes();
				loadCities();
			};
			
			function loadAllHomes() {
				d3.csv("data/City_Zhvi_AllHomes.csv").then(function(data) {
					if (data == undefined) {
						console.log("Failed to load file");

						return;
					}
					data.forEach(function(d) {
						if (records[d.RegionName] != undefined) {
							let sum = 0, average;
							if (records[d.RegionName]["2015-2020-count"] !== 0) {
								for (let i = 2015; i < 2021; i++) {
									if (i === 2020) {
										records[d.RegionName][i+"-price"] = parseInt((~~parseInt(d[i+"-01"]) + ~~parseInt(d[i+"-02"]) + ~~parseInt(d[i+"-03"])) / 3);

										break;
									}
									records[d.RegionName][i+"-price"] = parseInt((~~parseInt(d[i+"-01"]) + ~~parseInt(d[i+"-02"]) + ~~parseInt(d[i+"-03"]) + ~~parseInt(d[i+"-04"]) + ~~parseInt(d[i+"-05"]) + ~~parseInt(d[i+"-06"]) + ~~parseInt(d[i+"-07"]) + ~~parseInt(d[i+"-08"]) + ~~parseInt(d[i+"-09"]) + ~~parseInt(d[i+"-10"]) + ~~parseInt(d[i+"-11"]) + ~~parseInt(d[i+"-12"])) / 12);
								}

								for (let i = 2015; i < 2021; i++) {
									sum += records[d.RegionName][i+"-price"];
									
									price[i] = records[d.RegionName][i+"-price"];
									
									if (price.maximun < records[d.RegionName][i+"-price"]) {
										price.maximun = records[d.RegionName][i+"-price"];
										price.maximunCity = records[d.RegionName];
										price.maximunYear = i;
									} else if(price.minimun > records[d.RegionName][i+"-price"]) {
										price.minimun = records[d.RegionName][i+"-price"];
										price.minimunCity = records[d.RegionName];
										price.minimunYear = i;
									}
								}

								average = parseInt(sum / 6);

								records[d.RegionName]["2015-2020-price"] = average;
								
								if (price.totalMaximun < average) {
									price.totalMaximun = average;
								} else if(price.totalMinimun > average) {
									price.totalMinimun = average;
								}

								price.total += average;
							}
						}
					});
					price.average = ~~parseInt(price.total) / bayareaCitiesList.length;
			
					drawMap();
					drawPanel();
				});
			};
			
			function loadCities() {
				d3.csv("data/City_Coordinates.csv").then(function(data) {
					if (data == undefined) {
						console.log("Failed to load file");

						return;
					}
					data.forEach(function(d) {
						if (records[d.RegionName] != undefined) {
							records[d.RegionName]["latitude"] = d.Latitude != "" ? d.Latitude : 0;
							records[d.RegionName]["longitude"] = d.Longitude != "" ? d.Longitude : 0;
						}
					});
				});
				
				// Convert the records object to an array
				data = Object.keys(records).map(function(key) { 
					return records[key]; 
				});
			}
			
			function drawMap() {
				d3.json("data/counties-albers-10m.json").then(drawElements);
				
				let width = 600, height = 500;
//				
//				let mapWidth = 960;
//				let mapHeight = 600;

				// Declare and initialize all graph elements
				const map = d3
					.select("svg#map")
					.attr("x", 0)
					.attr("width", width)
					.attr("height", height)
					.attr("viewBox", "0 0 "+width+" "+height);
				
				const g = {
					tooltip: map.select("g#tooltip"),
					legend: map.select("g#legend")
				};
				
				let basemap = map.select("g#basemap")
					.style("transform", "translate(-250px, -4000px) scale(16)");
				let states = basemap.select("g#states");
				let counties = basemap.select("g#counties");
				let cities = basemap.select("g#cities");
				
				function drawElements(json) {
					// D3 Projection
					let projection = d3.geoAlbersUsa().scale(1300).translate([487.5, 305]);     // scale things down so see entire US

					// Define path generator
					let path = d3.geoPath();  // tell path generator to use albersUsa projection

					states.append("g")
						.attr("class", "states")
						.selectAll("path")
						.data(topojson.feature(json, json.objects.states).features)
						.enter().append("path")
						.attr("d", path)
						.attr("class", "state");


					states.append("path")
						.datum(topojson.mesh(json, json.objects.states, function(a, b) { return a !== b; }))
						.attr("class", "state-borders")
						.attr("d", path);
					
					
					counties.append("g")
						.attr("class", "counties")
						.selectAll("path")
						.data(topojson.feature(json, json.objects.counties).features)
						.enter().append("path")
						.attr("d", path);

					counties.append("path")
						.attr("class", "county-borders")
						.attr("d", path(topojson.mesh(json, json.objects.counties, function(a, b) { return a !== b; })));
					
					cities.selectAll("circle")
						.data(data)
						.enter()
						.append("circle")
						.attr("class", "city")
						.attr("cx", function(d) {
							if (projection([d.longitude, d.latitude]) == undefined) return;
							return projection([d.longitude, d.latitude])[0];
						})
						.attr("cy", function(d) {
							if (projection([d.longitude, d.latitude]) == undefined) return;
							return projection([d.longitude, d.latitude])[1];
						})
						.attr("r", function(d) {
							return 0.2 + (d["2015-2020-price"] / price.totalMaximun);
						})
						.style("fill", colorMain)
						.style("stroke", "#fff")
						.style("stroke-width", 0.1);

					// determines which states belong to the continental united states
					// https://gist.github.com/mbostock/4090846#file-us-state-names-tsv
					function isContinental(state) {
						const id = parseInt(state.id);
						return id < 60 && id !== 2 && id !== 15;
					}
				}
			
			}
			
			function drawPanel() {
				let width = 500, height = 800;
				
				const panel = d3
					.select("svg#panel")
					.attr("width", width)
					.attr("height", height)
					.attr("viewBox", "0 0 "+width+" "+height);
				
				let barCount = panel.select("g#bar-count");
				let barPrice = panel.select("g#bar-price");
				let lineCount = panel.select("g#line-count");
				let linePrice = panel.select("g#line-price");
				
				drawBarCount();
//				drawBarPrice();
//				drawLineCount();
//				drawLinePrice();
				
				function drawBarCount() {
					var margin = {top: 0, right: 25, bottom: 25, left: 120};
					
					let xScale = d3.scaleBand().range([0, width]).padding(0.4);
					let yScale = d3.scaleLinear().range([height, 0]);
					
					barCount
  					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
					
					let countData = data.sort(compareCount);
					
					xScale = d3.scaleLinear()
							.range([0, width])
							.domain([0, count.totalMaximun]);

					yScale = d3.scaleBand()
							.range([0, height])
							.padding(0.2)
							.domain(countData.map(function(d) { 
								return d.name;
							}));
					
					let xAxis = barCount.append("g")
						.attr("transform", "translate(0," + height + ")")
						.call(d3.axisBottom(xScale).tickFormat(function(d){
							return d/1000 + "K";
						})
						.ticks(10))
						.attr("class", "x-axis")
						.append("text")
						.attr("class", "label")
						.attr("y", -300)
						.attr("x", width)
						.attr("text-anchor", "end")
						.attr("stroke", "#2d3666")
						.text("Count of House Sales");

					let yAxis = barCount.append("g")
						.call(d3.axisLeft(yScale))
						.attr("class", "y-axis")
						.append("text")
						.attr("transform", "rotate(-90)")
						.attr("y", 60)
						.attr("dy", "-16em")
						.attr("text-anchor", "end")
						.attr("stroke", "#2d3666")
						.attr("class", "label")
						.text("City Names");
					
					let bars = barCount.append("g")
						.attr("class", "bars-count")
						.attr("x", 0)
						.attr("y", -100);
					
					let bar = bars.selectAll(".bar-count")
						.data(countData)
						.enter()
						.append("rect")
						.attr("class", "bar-count")
						.attr("x", 0)
						.attr("y", function(d) {
							return yScale(d.name);
						})
						.attr("width", function(d) {
							return xScale(d["2015-2020-count"]);
						})
						.attr("height", yScale.bandwidth())
						.style("fill", colorMain);
				}
				
				function drawBarPrice() {
					let priceData = data.sort(comparePrice);
					
					let xScale = d3.scaleBand().range([0, width]).padding(0.4);
					let yScale = d3.scaleLinear().range([height, 0]);
					
					xScale = d3.scaleLinear()
							.range([0, width])
							.domain([0, price.maximun]);

					yScale = d3.scaleBand()
							.range([0, height])
							.padding(0.2)
							.domain(priceData.map(function(d) { 
								return d.name;
							}));
					
					let xAxis = barPrice.append("g")
						.attr("transform", "translate(0," + height + ")")
						.call(d3.axisBottom(xScale).tickFormat(function(d){
							return d/1000 + "K";
						})
						.ticks(10))
						.attr("class", "x-axis")
						.append("text")
						.attr("class", "label")
						.attr("y", -100)
						.attr("x", width)
						.attr("text-anchor", "end")
						.attr("stroke", "#2d3666")
						.text("City Names");

					let yAxis = barPrice.append("g")
						.call(d3.axisLeft(yScale))
						.attr("class", "y-axis")
						.append("text")
						.attr("transform", "rotate(-90)")
						.attr("y", 60)
						.attr("dy", "-16em")
						.attr("text-anchor", "end")
						.attr("stroke", "#2d3666")
						.attr("class", "label")
						.text("Count of House Sales");

					// Create the bars' container
					let bars = barPrice.append("g")
						.attr("class", "bars-price")
						.attr("x", 0)
						.attr("y", 200);

					let bar = bars.selectAll(".bar-price")
						.data(priceData)
						.enter()
						.append("rect")
						.attr("class", "bar-price")
						.attr("x", 0)
						.attr("y", function(d) {
							return yScale(d.name);
						})
						.attr("width", function(d) {
							return xScale(d["2015-2020-price"]);
						})
						.attr("height", yScale.bandwidth())
						.style("fill", colorMain);
				}
				
				function drawLineCount() {
					height = 400;
					
					var margin = {top: 20, right: 25, bottom: 25, left: 60};
					
					lineCount
  					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
					
					let values = [];
					
					for (let i = 2015; i < 2021; i++) {
						values.push({
							date: i,
							value: ~~parseInt(count[i])
						});
					}
					
					console.log(values);
					
					let xScale = d3.scaleTime().range([0, width]);

					xScale.domain(d3.extent(values, function(d) { return d.date; }));
					
					let yScale = d3.scaleLinear().range([height, 0]);

					yScale.domain([d3.min(values, function(d) { return d.value; }), d3.max(values, function(d) { return d.value; })]);

					
					var line = d3.line()
						.x(function(d) { return xScale(d.date); }) // set the x values for the line generator
						.y(function(d) { return yScale(d.value); }) // set the y values for the line generator
					
					lineCount.append("g")
						.attr("class", "x-axis")
						.attr("transform", "translate(0," + 400 + ")")
						.call(d3.axisBottom(xScale)); // Create an axis component with d3.axisBottom

					lineCount.append("g")
						.attr("class", "y-axis")
						.call(d3.axisLeft(yScale)); // Create an axis component with d3.axisLeft

					lineCount.append("path")
						.datum(values) // 10. Binds data to the line 
						.attr("class", "line") // Assign a class for styling 
						.attr('fill', 'none')
						.attr('stroke', colorMain)
						.attr('stroke-width', 1.5)
						.attr('d', line);

				}
				
				function drawLinePrice() {
					height = 400;
					
					var margin = {top: 20, right: 25, bottom: 25, left: 100};
					
					linePrice
  					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
					
					let values = [];
					
					for (let i = 2015; i < 2021; i++) {
						values.push({
							date: i,
							value: ~~parseInt(price[i])
						});
					}
					
					console.log(values);
					
					let xScale = d3.scaleTime().range([0, width]);

					xScale.domain([2015, 2022]);
					
					let yScale = d3.scaleLinear().range([height, 0]);

					yScale.domain([d3.min(values, function(d) { return d.value; }), d3.max(values, function(d) { return d.value; })]);

					
					var line = d3.line()
						.x(function(d) { return xScale(d.date); }) // set the x values for the line generator
						.y(function(d) { return yScale(d.value); }) // set the y values for the line generator
					
					linePrice.append("g")
						.attr("class", "x-axis")
						.attr("transform", "translate(0," + 400 + ")")
						.call(d3.axisBottom(xScale)); // Create an axis component with d3.axisBottom

					linePrice.append("g")
						.attr("class", "y-axis")
						.call(d3.axisLeft(yScale)); // Create an axis component with d3.axisLeft

					linePrice.append("path")
						.datum(values) // 10. Binds data to the line 
						.attr("class", "line") // Assign a class for styling 
						.attr('fill', 'none')
						.attr('stroke', colorMain)
						.attr('stroke-width', 1.5)
						.attr('d', line);
				}
				
				function compareCount(a, b) {
					const countA = a["2015-2020-count"];
					const countB = b["2015-2020-count"];

					let comparison = 0;
					if (countA < countB) {
						comparison = 1;
					} else if (countA > countB) {
						comparison = -1;
					}
					
					return comparison;
				}
				
				function comparePrice(a, b) {
					const priceA = a["2015-2020-price"];
					const priceB = b["2015-2020-price"];

					let comparison = 0;
					if (priceA < priceB) {
						comparison = 1;
					} else if (priceA > priceB) {
						comparison = -1;
					}
					
					return comparison;
				}
			}
			
		</script>
		<script src="../../ui/vendor/jquery.min.js"></script>
		<script src="../../ui/vendor/popper.min.js"></script>
		<script src="../../ui/vendor/bootstrap.min.js"></script>
		<script src="../../ui/vendor/perfect-scrollbar.min.js"></script>
		<script src="../../ui/vendor/hammer.min.js"></script>
		<script src="../../ui/vendor/jquery-ui/jquery-ui.min.js"></script>
		<script src="../../ui/vendor/color/color.min.js"></script>
		<script src="../../ui/vendor/fontawesome.min.js"></script>
		<script src="../../ui/scripts/sidebar.min.js"></script>
		<script src="../../ui/scripts/collapsible-nav.min.js"></script>
		<script src="../../ui/scripts/colors.min.js"></script>
		<script src="../../ui/scripts/settings.min.js"></script>
		<script src="../../ui/scripts/card.min.js"></script>
		<script src="../../ui/scripts/script.js"></script>
	</body>
</html>
